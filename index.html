<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>××™×œ×•×ª ×©×™×™×›×•×ª ×•×§×™×©×•×¨ ×‘×× ×’×œ×™×ª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      --accent: #ffaf40;
      --accent-2: #2ed573;
      --text: #f4f9ff;
      --card-bg: rgba(255, 255, 255, 0.13);
      --card-border: rgba(255, 255, 255, 0.18);
      --shadow: 0 20px 40px rgba(15, 32, 39, 0.3);
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Rubik', 'Assistant', Arial, sans-serif;
      background: var(--bg-gradient);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      width: 100%;
      padding: clamp(20px, 6vw, 60px);
      text-align: center;
      background: rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: clamp(1.7rem, 4vw, 3rem);
      letter-spacing: 0.04em;
    }
    header p {
      margin: 10px auto 0;
      max-width: 600px;
      font-size: clamp(0.95rem, 2.5vw, 1.1rem);
      opacity: 0.85;
    }
    main {
      width: min(1020px, 96vw);
      margin: 30px auto 60px;
      display: grid;
      gap: 26px;
    }
    section {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 22px;
      padding: clamp(18px, 4vw, 28px);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    h2.section-title {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: clamp(1.2rem, 3.6vw, 1.8rem);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      font-size: 0.9rem;
    }
    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 18px;
    }
    .category-buttons button {
      flex: 1 1 150px;
      padding: 12px 18px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: #1e272e;
      background: rgba(255, 175, 64, 0.82);
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .category-buttons button.active {
      background: rgba(46, 213, 115, 0.9);
      transform: translateY(-2px);
    }
    .category-buttons button:hover {
      transform: translateY(-3px) scale(1.01);
    }
    .word-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
    }
    .word-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 18px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 180px;
      position: relative;
      overflow: hidden;
    }
    .word-card h3 {
      margin: 0;
      font-size: 1.35rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .word-card h3 button {
      border: none;
      background: rgba(46, 213, 115, 0.85);
      color: #1e272e;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: transform 0.2s ease;
    }
    .word-card h3 button:hover {
      transform: scale(1.07);
    }
    .word-card p {
      margin: 0;
      font-size: 0.98rem;
      line-height: 1.5;
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.18);
      font-size: 0.8rem;
      color: #ffffff;
      font-weight: 600;
    }
    .divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.15);
      margin: 10px 0;
    }
    .flashcard {
      position: relative;
      min-height: 240px;
      display: grid;
      place-items: center;
      padding: 26px;
      border-radius: 20px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.04));
      text-align: center;
    }
    .flashcard-word {
      font-size: clamp(1.4rem, 5vw, 2.3rem);
      margin-bottom: 10px;
    }
    .flashcard-translation {
      font-size: clamp(1.1rem, 4vw, 1.6rem);
      color: rgba(255, 255, 255, 0.8);
    }
    .flashcard-example {
      margin-top: 12px;
      font-size: 1rem;
      opacity: 0.85;
    }
    .flashcard-controls {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .btn {
      padding: 12px 18px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      color: #1e272e;
      background: rgba(255, 255, 255, 0.85);
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
    }
    .btn.accent {
      background: rgba(46, 213, 115, 0.95);
    }
    .quiz-card {
      display: grid;
      gap: 14px;
    }
    .quiz-question {
      font-size: 1.15rem;
      font-weight: 500;
    }
    .quiz-options {
      display: grid;
      gap: 10px;
    }
    .quiz-options button {
      text-align: right;
      background: rgba(255, 255, 255, 0.12);
      color: var(--text);
    }
    .quiz-options button.correct {
      background: rgba(46, 213, 115, 0.9);
      color: #1e272e;
    }
    .quiz-options button.wrong {
      background: rgba(255, 99, 72, 0.9);
      color: #fff;
    }
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.95rem;
      opacity: 0.85;
    }
    .progress-track {
      width: 100%;
      height: 10px;
      background: rgba(255, 255, 255, 0.12);
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 0.4s ease;
    }
    .sentence-builder {
      display: grid;
      gap: 12px;
    }
    .sentence-builder select,
    .sentence-builder input {
      width: 100%;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.88);
    }
    .sentence-output {
      min-height: 48px;
      border-radius: 14px;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
    }
    footer {
      width: 100%;
      padding: 30px 12px 40px;
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    @media (min-width: 920px) {
      main {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      section.full-width {
        grid-column: span 2;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>English Linkers & Possessives</h1>
    <p>××¤×œ×™×§×¦×™×” ×•×¨×¡×˜×™×œ×™×ª ×©×ª×¢×–×•×¨ ×œ×š ×œ×©×œ×•×˜ ×‘××™×œ×•×ª ×”×©×™×™×›×•×ª ×•×”×§×™×©×•×¨ ×”×—×©×•×‘×•×ª ×‘×× ×’×œ×™×ª ×‘×¢×–×¨×ª ×”×¡×‘×¨×™×, ×›×¨×˜×™×¡×™×•×ª, ×ª×¨×’×•×œ ×•×¡×˜×˜×•×¡ ××ª×§×“×.</p>
  </header>
  <main>
    <section class="full-width" id="overview">
      <h2 class="section-title">××¤×ª ×“×¨×›×™× ×œ×œ××™×“×” <span class="pill">Start Smart</span></h2>
      <div class="status-bar">
        <span>×¨××ª ×“×™×•×§ ×‘×—×™×“×•×Ÿ: <strong id="quizAccuracy">0%</strong></span>
        <span>×›×¨×˜×™×¡×™×•×ª ×©× ×œ××“×•: <strong id="flashcardsProgress">0 ××ª×•×š 12</strong></span>
        <div class="progress-track">
          <div id="progressFill" class="progress-fill"></div>
        </div>
      </div>
      <p style="margin-top:14px; line-height:1.6; font-size:1rem; opacity:0.85;">×”×ª×—×™×œ×• ×‘×¡×§×™×¨×ª ×”××™×œ×™×, ×¢×‘×¨×• ×œ×ª×¨×’×•×œ ×‘×›×¨×˜×™×¡×™×•×ª, × ×¡×• ××ª ×”×—×™×“×•×Ÿ ×›×“×™ ×œ×‘×—×•×Ÿ ××ª ×¢×¦××›× ×•×œ×‘×¡×•×£ ×‘× ×• ××©×¤×˜×™× ××©×œ×›× ×‘×¢×–×¨×ª ××—×•×œ×œ ×”××©×¤×˜×™×.</p>
    </section>

    <section id="wordExplorer">
      <h2 class="section-title">×—×§×¨ ××™×œ×™× <span class="pill">Discover</span></h2>
      <div class="category-buttons">
        <button class="active" data-category="possessive">××™×œ×•×ª ×©×™×™×›×•×ª</button>
        <button data-category="linking">××™×œ×•×ª ×§×™×©×•×¨</button>
      </div>
      <div id="wordGrid" class="word-grid"></div>
    </section>

    <section id="flashcards" class="full-width">
      <h2 class="section-title">×›×¨×˜×™×¡×™×•×ª ××™× ×˜×¨××§×˜×™×‘×™×•×ª <span class="pill">Practice</span></h2>
      <div class="flashcard" aria-live="polite">
        <div id="flashcardWord" class="flashcard-word">×‘×—×¨×• ×›×¨×˜×™×¡ ×œ×”×ª×—×œ×”</div>
        <div id="flashcardTranslation" class="flashcard-translation"></div>
        <div id="flashcardExample" class="flashcard-example"></div>
      </div>
      <div class="flashcard-controls">
        <button class="btn" id="prevCard">×”×§×•×“×</button>
        <button class="btn accent" id="flipCard">×”×¦×’/×”×¡×ª×¨ ×¤×™×¨×•×˜</button>
        <button class="btn" id="nextCard">×”×‘×</button>
        <button class="btn" id="speakCard">×”×©××¢×”</button>
        <button class="btn" id="markLearned">×¡×™×™××ª×™ ×œ×œ××•×“</button>
      </div>
    </section>

    <section id="quiz">
      <h2 class="section-title">×—×™×“×•×Ÿ ××”×™×¨ <span class="pill">Check Yourself</span></h2>
      <div class="quiz-card">
        <div id="quizQuestion" class="quiz-question">×œ×—×¦×• "×©××œ×” ×—×“×©×”" ×›×“×™ ×œ×”×ª×—×™×œ.</div>
        <div id="quizOptions" class="quiz-options"></div>
        <div class="flashcard-controls">
          <button class="btn accent" id="newQuestion">×©××œ×” ×—×“×©×”</button>
          <button class="btn" id="resetQuiz">××™×¤×•×¡ × ×ª×•× ×™×</button>
        </div>
      </div>
    </section>

    <section id="sentenceBuilder">
      <h2 class="section-title">××—×•×œ×œ ××©×¤×˜×™× <span class="pill">Create</span></h2>
      <div class="sentence-builder">
        <label>
          ×‘×—×¨×• ×¡×•×’ ××©×¤×˜:
          <select id="sentenceType">
            <option value="possessive">×©×™×™×›×•×ª - ×œ×“×•×’××”: ×–×”×• ×”×¡×¤×¨ ×©×œ×™</option>
            <option value="linking">×§×™×©×•×¨ - ×œ×“×•×’××”: ×× ×™ ××•×”×‘ ×•×’× ××‘×©×œ</option>
          </select>
        </label>
        <label>
          ×‘×—×¨×• × ×•×©×:
          <select id="subjectSelect"></select>
        </label>
        <label>
          ×‘×—×¨×• ×ª×•×¡×¤×ª:
          <select id="detailSelect"></select>
        </label>
        <button class="btn accent" id="buildSentence">×¦×¨×• ××©×¤×˜</button>
        <div id="sentenceOutput" class="sentence-output">×”××©×¤×˜ ×™×•×¤×™×¢ ×›××Ÿ.</div>
      </div>
    </section>
  </main>
  <footer>
    ×¤×™×ª×•×—: ××¤×œ×™×§×¦×™×™×ª ×œ×™××•×“ ××™× ×˜×¨××§×˜×™×‘×™×ª ×œ××™×œ×•×ª ×©×™×™×›×•×ª ×•×§×™×©×•×¨ ×‘×× ×’×œ×™×ª. ×©××¨×• ××ª ×”×ª×§×“××•×ª×›× ×‘×›×œ ×‘×™×§×•×¨.
  </footer>

  <script>
    const wordsData = [
      { category: 'possessive', word: 'my', translation: '×©×œ×™', explanation: '××©××© ×œ×¤× ×™ ×©× ×¢×¦× ×›×“×™ ×œ×¦×™×™×Ÿ ×‘×¢×œ×•×ª ×©×œ ×”×“×•×‘×¨.', example: 'This is my favorite song.' },
      { category: 'possessive', word: 'your', translation: '×©×œ×š/×©×œ×›×', explanation: '××‘×™×¢ ×‘×¢×œ×•×ª ×©×œ ×‘×Ÿ ×”×©×™×— ××• ×©×œ ×”×§×‘×•×¦×” ××œ×™×” ×¤×•× ×™×.', example: 'Is this your notebook?' },
      { category: 'possessive', word: 'his', translation: '×©×œ×•', explanation: '××¦×™×™×Ÿ ×‘×¢×œ×•×ª ×©×œ ×’×‘×¨ ××• ×©×œ ×—×¤×¥ ×”×©×™×™×š ×œ×•.', example: 'His car is very fast.' },
      { category: 'possessive', word: 'her', translation: '×©×œ×”', explanation: '××¦×™×™×Ÿ ×‘×¢×œ×•×ª ×©×œ ××™×©×”.', example: 'Her ideas are inspiring.' },
      { category: 'possessive', word: 'our', translation: '×©×œ× ×•', explanation: '××¦×™×™×Ÿ ×‘×¢×œ×•×ª ××©×•×ª×¤×ª ×©×œ ×”×“×•×‘×¨ ×•××—×¨×™×.', example: 'Our team won the match.' },
      { category: 'possessive', word: 'their', translation: '×©×œ×”×/×©×œ×”×Ÿ', explanation: '××¦×™×™×Ÿ ×‘×¢×œ×•×ª ×©×œ ×§×‘×•×¦×” ××—×¨×ª.', example: 'Their house is near the beach.' },
      { category: 'linking', word: 'and', translation: '×•×’×', explanation: '××•×¡×™×£ ××™×“×¢ ××• ×¤×¨×˜ × ×•×¡×£ ×‘××•×ª×• ××©×¤×˜.', example: 'She plays the piano and sings beautifully.' },
      { category: 'linking', word: 'but', translation: '××‘×œ', explanation: '××¦×™×’ × ×™×’×•×“ ××• ×”×‘×“×œ×™×.', example: 'I wanted to go out, but it was raining.' },
      { category: 'linking', word: 'because', translation: '×›×™ / ×‘×’×œ×œ', explanation: '××¦×™×™×Ÿ ×¡×™×‘×” ××• ×”×¡×‘×¨.', example: 'We stayed home because it was snowing.' },
      { category: 'linking', word: 'so', translation: '×œ×›×Ÿ', explanation: '××¦×™×™×Ÿ ×ª×•×¦××” ××• ××¡×§× ×”.', example: 'He was tired, so he went to bed early.' },
      { category: 'linking', word: 'although', translation: '×œ××¨×•×ª ×©Ö¾', explanation: '××©××© ×›×“×™ ×œ×”×¦×™×’ ×¡×ª×™×¨×”.', example: 'Although it was cold, they went swimming.' },
      { category: 'linking', word: 'therefore', translation: '×œ×¤×™×›×š', explanation: '××™×œ×” ×¨×©××™×ª ×”××¦×™×’×” ××¡×§× ×”.', example: 'The road was closed; therefore, we took another route.' }
    ];

    const quizTemplates = [
      {
        type: 'multipleChoice',
        buildQuestion() {
          const item = randomItem(wordsData);
          const incorrect = shuffle(wordsData.filter(w => w.category === item.category && w.word !== item.word)).slice(0, 3);
          const options = shuffle([item, ...incorrect]);
          return {
            text: `××” ×”×¤×™×¨×•×© ×©×œ "${item.word}"?`,
            options: options.map(opt => ({ text: `${opt.translation} â€“ ${opt.explanation}`, correct: opt.word === item.word })),
            speak: item.word
          };
        }
      },
      {
        type: 'fillBlank',
        buildQuestion() {
          const item = randomItem(wordsData);
          const sentence = createSentenceTemplate(item);
          const options = shuffle([item.word, ...generateDistractors(item.word)]);
          return {
            text: sentence.replace('___', '_____'),
            options: options.map(opt => ({ text: opt, correct: opt === item.word })),
            speak: sentence.replace('___', item.word)
          };
        }
      }
    ];

    const subjects = {
      possessive: [
        { en: 'My brother', he: '×”××— ×©×œ×™' },
        { en: 'Our teacher', he: '×”××•×¨×” ×©×œ× ×•' },
        { en: 'Their dog', he: '×”×›×œ×‘ ×©×œ×”×' },
        { en: 'Her sister', he: '××—×•×ª×”' }
      ],
      linking: [
        { en: 'I enjoy learning', he: '×× ×™ × ×”× ×” ×œ×œ××•×“' },
        { en: 'She cooked dinner', he: '×”×™× ×‘×™×©×œ×” ××¨×•×—×ª ×¢×¨×‘' },
        { en: 'We finished the project', he: '×¡×™×™×× ×• ××ª ×”×¤×¨×•×™×§×˜' },
        { en: 'They trained all week', he: '×”× ×”×ª××× ×• ×›×œ ×”×©×‘×•×¢' }
      ]
    };

    const details = {
      possessive: [
        { en: 'his new guitar', he: '×”×’×™×˜×¨×” ×”×—×“×©×” ×©×œ×•' },
        { en: 'our shared memories', he: '×”×–×™×›×¨×•× ×•×ª ×”××©×•×ª×¤×™× ×©×œ× ×•' },
        { en: 'their weekend plans', he: '×ª×•×›× ×™×•×ª ×¡×•×£ ×”×©×‘×•×¢ ×©×œ×”×' },
        { en: 'her creative projects', he: '×”×¤×¨×•×™×§×˜×™× ×”×™×¦×™×¨×ª×™×™× ×©×œ×”' }
      ],
      linking: [
        { en: 'we celebrated together', he: '×—×’×’× ×• ×‘×™×—×“' },
        { en: 'he needed some rest', he: '×”×•× ×”×™×” ×¦×¨×™×š ×× ×•×—×”' },
        { en: 'everyone applauded', he: '×›×•×œ× ××—××• ×›×¤×™×™×' },
        { en: 'they asked for advice', he: '×”× ×‘×™×§×©×• ×¢×¦×”' }
      ]
    };

    let currentCategory = 'possessive';
    let currentCardIndex = 0;
    let showingDetails = false;
    let learnedSet = new Set(JSON.parse(localStorage.getItem('learnedCards') || '[]'));
    let quizStats = JSON.parse(localStorage.getItem('quizStats') || '{"correct":0,"total":0}');

    const wordGrid = document.getElementById('wordGrid');
    const categoryButtons = document.querySelectorAll('.category-buttons button');
    const flashcardWord = document.getElementById('flashcardWord');
    const flashcardTranslation = document.getElementById('flashcardTranslation');
    const flashcardExample = document.getElementById('flashcardExample');
    const progressFill = document.getElementById('progressFill');
    const quizAccuracy = document.getElementById('quizAccuracy');
    const flashcardsProgress = document.getElementById('flashcardsProgress');
    const sentenceType = document.getElementById('sentenceType');
    const subjectSelect = document.getElementById('subjectSelect');
    const detailSelect = document.getElementById('detailSelect');
    const sentenceOutput = document.getElementById('sentenceOutput');

    function init() {
      renderWordGrid();
      loadFlashcard(currentCardIndex);
      updateProgressBar();
      updateQuizStats();
      populateSentenceBuilder();
      setupEventListeners();
    }

    function renderWordGrid() {
      const filtered = wordsData.filter(w => w.category === currentCategory);
      wordGrid.innerHTML = filtered.map(item => `
        <article class="word-card">
          <div>
            <h3>${item.word}
              <button aria-label="×”×©××¢×” ×¢×‘×•×¨ ${item.word}" data-word="${item.word}">ğŸ”Š</button>
            </h3>
            <span class="badge">${item.translation}</span>
          </div>
          <div class="divider"></div>
          <p>${item.explanation}</p>
          <p style="font-style:italic; opacity:0.85;">${item.example}</p>
        </article>
      `).join('');
      wordGrid.querySelectorAll('button[data-word]').forEach(btn => {
        btn.addEventListener('click', () => speakWord(btn.dataset.word));
      });
    }

    function loadFlashcard(index) {
      const item = wordsData[index];
      if (!item) return;
      flashcardWord.textContent = item.word;
      flashcardTranslation.textContent = showingDetails ? `${item.translation} â€¢ ${item.explanation}` : item.translation;
      flashcardExample.textContent = showingDetails ? item.example : '';
      flashcardTranslation.style.opacity = showingDetails ? '1' : '0.85';
      flashcardExample.style.opacity = showingDetails ? '0.85' : '0';
    }

    function changeCard(step) {
      currentCardIndex = (currentCardIndex + step + wordsData.length) % wordsData.length;
      showingDetails = false;
      loadFlashcard(currentCardIndex);
    }

    function toggleDetails() {
      showingDetails = !showingDetails;
      loadFlashcard(currentCardIndex);
    }

    function markLearned() {
      learnedSet.add(currentCardIndex);
      localStorage.setItem('learnedCards', JSON.stringify(Array.from(learnedSet)));
      updateProgressBar();
    }

    function updateProgressBar() {
      const percent = Math.round((learnedSet.size / wordsData.length) * 100);
      progressFill.style.width = percent + '%';
      flashcardsProgress.textContent = `${learnedSet.size} ××ª×•×š ${wordsData.length}`;
    }

    function setupEventListeners() {
      categoryButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          categoryButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentCategory = btn.dataset.category;
          renderWordGrid();
        });
      });

      document.getElementById('prevCard').addEventListener('click', () => changeCard(-1));
      document.getElementById('nextCard').addEventListener('click', () => changeCard(1));
      document.getElementById('flipCard').addEventListener('click', toggleDetails);
      document.getElementById('speakCard').addEventListener('click', () => {
        const item = wordsData[currentCardIndex];
        speakWord(item.word);
      });
      document.getElementById('markLearned').addEventListener('click', markLearned);

      document.getElementById('newQuestion').addEventListener('click', generateQuestion);
      document.getElementById('resetQuiz').addEventListener('click', () => {
        quizStats = { correct: 0, total: 0 };
        localStorage.setItem('quizStats', JSON.stringify(quizStats));
        updateQuizStats();
        document.getElementById('quizQuestion').textContent = '×”× ×ª×•× ×™× ××•×¤×¡×•. ×œ×—×¦×• "×©××œ×” ×—×“×©×”" ×›×“×™ ×œ×”××©×™×š.';
        document.getElementById('quizOptions').innerHTML = '';
      });

      document.getElementById('buildSentence').addEventListener('click', buildSentence);
      sentenceType.addEventListener('change', populateSentenceBuilder);
    }

    function generateQuestion() {
      const template = randomItem(quizTemplates);
      const question = template.buildQuestion();
      const questionContainer = document.getElementById('quizQuestion');
      const optionsContainer = document.getElementById('quizOptions');

      questionContainer.textContent = question.text;
      optionsContainer.innerHTML = '';

      question.options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = option.text;
        btn.addEventListener('click', () => handleQuizAnswer(btn, option.correct, question.speak));
        optionsContainer.appendChild(btn);
      });

      if (question.speak) {
        speakWord(question.speak);
      }
    }

    function handleQuizAnswer(button, isCorrect, spokenSentence) {
      const optionButtons = button.parentElement.querySelectorAll('button');
      optionButtons.forEach(btn => btn.disabled = true);

      if (isCorrect) {
        button.classList.add('correct');
        quizStats.correct += 1;
        speakWord(spokenSentence);
      } else {
        button.classList.add('wrong');
      }
      quizStats.total += 1;
      localStorage.setItem('quizStats', JSON.stringify(quizStats));
      updateQuizStats();
    }

    function updateQuizStats() {
      const accuracy = quizStats.total ? Math.round((quizStats.correct / quizStats.total) * 100) : 0;
      quizAccuracy.textContent = accuracy + '%';
    }

    function populateSentenceBuilder() {
      const type = sentenceType.value;
      fillSelect(subjectSelect, subjects[type]);
      fillSelect(detailSelect, details[type]);
      sentenceOutput.textContent = '×”××©×¤×˜ ×™×•×¤×™×¢ ×›××Ÿ.';
    }

    function fillSelect(selectEl, items) {
      selectEl.innerHTML = items.map((item, index) => `<option value="${index}">${item.en} (${item.he})</option>`).join('');
    }

    const linkingHebrewMap = {
      and: '×•×’×',
      but: '××‘×œ',
      because: '×›×™',
      so: '×œ×›×Ÿ',
      although: '×œ××¨×•×ª ×©Ö¾',
      therefore: '×œ×¤×™×›×š'
    };

    const possessiveTemplates = [
      {
        en: (subject, detail) => `${subject.en} is proud of ${detail.en}.`,
        he: (subject, detail) => `${subject.he} ×’××” ×‘${detail.he}.`
      },
      {
        en: (subject, detail) => `${subject.en} carefully keeps ${detail.en}.`,
        he: (subject, detail) => `${subject.he} ×©×•××¨/×ª ×‘×§×¤×™×“×” ×¢×œ ${detail.he}.`
      },
      {
        en: (subject, detail) => `${subject.en} shares ${detail.en} with friends.`,
        he: (subject, detail) => `${subject.he} ××©×ª×£/×ª ${detail.he} ×¢× ×—×‘×¨×™×.`
      }
    ];

    function buildSentence() {
      const type = sentenceType.value;
      const subject = subjects[type][subjectSelect.value];
      const detail = details[type][detailSelect.value];
      if (!subject || !detail) return;

      let sentence = '';
      let translation = '';

      if (type === 'possessive') {
        const template = randomItem(possessiveTemplates);
        sentence = template.en(subject, detail);
        translation = `×ª×¨×’×•× ×—×•×¤×©×™: ${template.he(subject, detail)}`;
      } else {
        const linkerWord = randomItem(wordsData.filter(item => item.category === 'linking')).word;
        sentence = `${subject.en} ${linkerWord} ${detail.en}.`;
        const linkerHe = linkingHebrewMap[linkerWord] || '×•×’×';
        translation = `×ª×¨×’×•× ×—×•×¤×©×™: ${subject.he} ${linkerHe} ${detail.he}.`;
      }
      sentenceOutput.innerHTML = `<div>${sentence}</div><div style="font-size:0.95rem; opacity:0.8; margin-top:6px;">${translation}</div>`;
      speakWord(sentence);
    }

    function createSentenceTemplate(item) {
      if (item.category === 'possessive') {
        return `___ brother lives in London.`;
      }
      const linkingTemplates = [
        `I wanted to call you, ___ I was too busy.`,
        `She studied hard ___ passed the exam.`,
        `We left early ___ avoid the traffic.`
      ];
      return randomItem(linkingTemplates);
    }

    function generateDistractors(correctWord) {
      const alternatives = wordsData.filter(item => item.word !== correctWord).map(item => item.word);
      return shuffle(alternatives).slice(0, 3);
    }

    function populateFromStorage() {
      learnedSet = new Set(JSON.parse(localStorage.getItem('learnedCards') || '[]'));
      quizStats = JSON.parse(localStorage.getItem('quizStats') || '{"correct":0,"total":0}');
    }

    function randomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function shuffle(array) {
      return [...array].sort(() => Math.random() - 0.5);
    }

    function speakWord(text) {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-US';
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    populateFromStorage();
    init();
  </script>
</body>
</html>
